# -* Makefile *- 
#
# Author : Patrick GOLDBRONN (CEA)
# Date : 28/06/2001
# $Header$
#

# source path
top_srcdir=@top_srcdir@
top_builddir=.
srcdir=@srcdir@
VPATH=.:@srcdir@:@top_srcdir@/bin:./bin/salome:@top_srcdir@/resources:./bin:@top_srcdir@/idl


@COMMENCE@

SUBDIRS = idl src examples doc salome_adm

RESOURCES_FILES = \
back.xpm \
cascade.png \
CatalogDataType.xml \
KERNELCatalog.xml \
CatalogResources.xml \
CatalogRessources.xml \
close.png \
config \
default.png \
dl_delete.png \
dl_insert.png \
dl_moveup.png \
dl_movedown.png \
forward.xpm \
help.png \
home.xpm \
new.png \
open.png \
print.png \
redo.png \
reset.png \
Application-Logo.png \
Application-Splash.png \
Application-About.png \
save.png \
select1.png \
tile.png \
Tools_en.xml \
undo.png \
view_back.png \
view_bottom.png \
view_camera_dump.png \
view_fitall.png \
view_fitarea.png \
view_front.png \
view_glpan.png \
view_left.png \
view_pan.png \
view_reset.png \
view_right.png \
view_rotate.png \
view_top.png \
view_triedre.png \
view_zoom.png \
copy.png \
paste.png \
plot2d_dump.png \
plot2d_fitall.png \
plot2d_fitarea.png \
plot2d_legend.png \
plot2d_linear.png \
plot2d_linear_y.png \
plot2d_lines.png \
plot2d_log.png \
plot2d_log_y.png \
plot2d_pan.png \
plot2d_points.png \
plot2d_settings.png \
plot2d_splines.png \
plot2d_zoom.png \
uc_add.png \
uc_current.png \
uc_del.png \
uc_new.png \
uc_clear.png \
channel.cfg \
Plugin \
SALOMEDS_Resources

BIN_SCRIPT= \
runIDLparser \
VERSION \
orbmodule.py \
runSalome.py \
killSalome.py \
killSalomeWithPort.py \
runSalome \
runSalome.csh \
runNS.sh \
launchConfigureParser.py \
salome.launch \
showNS.py

# copy header files in common directory
OWN_CONFIG_H=@OWN_CONFIG_H@

ifeq ($(OWN_CONFIG_H),yes)
    ifeq ($(HAVE_SSTREAM),yes)
	include_list=include/salome/SALOMEconfig.h include/salome/config.h
    else
	include_list=include/salome/SALOMEconfig.h include/salome/config.h include/salome/sstream
    endif
else
    ifeq ($(HAVE_SSTREAM),yes)
	include_list=include/salome/SALOMEconfig.h
    else
	include_list=include/salome/SALOMEconfig.h include/salome/sstream
    endif
endif

inc: idl $(include_list)

include/salome/SALOMEconfig.h: salome_adm/unix/SALOMEconfig.ref
	-$(RM) $@
	$(LN_S) ../../$< $@

# test if SALOMEconfig.h has changed (contents)
salome_adm/unix/SALOMEconfig.ref: salome_adm/unix/SALOMEconfig.h
	@if ! [ -a $@ ]; then \
	  cp -p $< $@;        \
	fi;		      \
	if ! cmp $< $@; then  \
	  cp -p $< $@;        \
	fi;		      \

include/salome/config.h: salome_adm/unix/config.h
	-$(RM) $@
	$(LN_S) ../../$< $@

include/salome/sstream: salome_adm/unix/sstream
	-$(RM) $@
	$(LN_S) ../../$< $@

depend: depend_idl

depend_idl:
	(cd idl ; $(MAKE) $@) || exit 1

# doc is already build : if you want to had documents, go manually to doc and run 'make doc'
#doc:
#	(cd doc && $(MAKE) $@) || exit 1

# Install make_commence make_conclude ... for other modules
install-make:
	($(INSTALL) -d  $(incmakedir) || exit 1);
	(sed 's/^prefix=/#prefix=/' $(top_builddir)/salome_adm/unix/make_commence > $(incmakedir)/make_commence || exit 1);
	(sed 's/^prefix=/#prefix=/' $(top_builddir)/salome_adm/unix/make_conclude > $(incmakedir)/make_conclude || exit 1);


install-end:
# finish libtool install
#	@$(LT) --mode=finish $(libdir)

install-include: $(include_list)
	$(INSTALL) -d  $(includedir)
	@for f in X $(include_list); do				\
	   if test $$f != X; then				\
	     (cp -p $$f $(includedir) || exit 1);		\
	   fi;							\
	done

# install script in $(bindir) :
install-bin: $(BIN_SCRIPT)
	$(INSTALL) -d  $(bindir)
	$(INSTALL_PROGRAM) $^ $(bindir)

uninstall: uninstall-idl

uninstall-idl:
	$(RM) $(idldir)/*.idl

distclean: distclean-other

distclean-other:
	-$(RM) salome_adm/unix/*~ salome_adm/unix/*% salome_adm/unix/*.bak salome_adm/unix/*.new salome_adm/unix/*.old
	-$(RM) salome_adm/unix/make_* 
	-$(RM) salome_adm/unix/depend salome_adm/unix/SALOMEconfig.h salome_adm/unix/config.h 
	-$(RM) config.cache config.log config.status 

@MODULE@

install: install-bin install-include install-make install-end

